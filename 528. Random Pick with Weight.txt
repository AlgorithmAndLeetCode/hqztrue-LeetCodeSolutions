1. prefix sum+binary search. O(n log n).
2. offline, generate all samples in a batch. reduce to sorting.
