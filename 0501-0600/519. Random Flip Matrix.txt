hashing+rejection sampling. O(1) per operation.
